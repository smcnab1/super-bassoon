<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ModuMate</title>
  
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Favicon and Manifest -->
  <link rel="shortcut icon" href="../../public/favicon/favicon.ico">
  <link rel="icon" type="image/x-icon" href="../../public/favicon/favicon.ico">
  <link rel="icon" type="image/svg+xml" href="../../public/favicon/favicon.svg">
  <link rel="icon" type="image/png" sizes="96x96" href="../../public/favicon/favicon-96x96.png">
  <link rel="apple-touch-icon" sizes="180x180" href="../../public/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="../../public/favicon/web-app-manifest-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="../../public/favicon/web-app-manifest-512x512.png">
  <link rel="manifest" href="../../public/favicon/site.webmanifest">
  <meta name="theme-color" content="#4a90e2">
  <meta name="msapplication-TileColor" content="#4a90e2">
  <meta name="msapplication-TileImage" content="../../public/favicon/web-app-manifest-192x192.png">
  
  <!-- Main Stylesheets -->
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="../styles/navbar.css">
  <link rel="stylesheet" href="../styles/login.css">
  <link rel="stylesheet" href="../styles/footer.css">
  <link rel="stylesheet" href="../styles/loading.css">
  <link rel="stylesheet" href="../styles/index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Theme Script (loads early for no-flash) -->
  <script src="../scripts/theme/index.js"></script>
  <script>
    // Set theme before page renders to avoid flash
    (function() {
      var theme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>
</head>
<body>
  <!-- Loading Overlay (injected before any content for instant feedback) -->
  <script>
    // Inject loading overlay HTML synchronously for instant feedback
    (function() {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', '../components/LoadingOverlay.html', false);
      xhr.send(null);
      if (xhr.status === 200) {
        var temp = document.createElement('div');
        temp.innerHTML = xhr.responseText;
        document.body.insertBefore(temp.firstElementChild, document.body.firstChild);
      }
    })();
  </script>
  <script src="../scripts/components/loadingOverlay.js"></script>

  <!-- Skip to main content link for accessibility -->
  <a href="#mainApp" class="skip-link">Skip to main content</a>
  
  <!-- Login Screen (hidden after authentication) -->
  <div id="loginScreen" class="login-screen" aria-modal="true" role="dialog" aria-labelledby="loginTitle" aria-describedby="loginDesc">
    <div class="login-container">
      <div class="login-header">
        <div class="login-logo">
          <img src="../../public/images/logo.png" alt="ModuMate Logo" width="80" height="80" style="object-fit: contain;">
        </div>
        <button class="btn btn-outline-primary theme-toggle-login" type="button" onclick="toggleTheme()" id="themeToggleLogin" aria-label="Toggle dark mode">üåô</button>
        <h1 id="loginTitle">ModuMate</h1>
        <p id="loginDesc">Please enter the password to access <strong>ModuMate</strong> LMS Template Generator</p>
      </div>
      <form id="loginForm" class="login-form" onsubmit="authenticate(event)">
        <div class="input-group">
          <label for="password">Password:</label>
          <div class="password-wrapper">
            <input type="password" id="password" name="password" required autocomplete="current-password" aria-describedby="passwordHelp">
            <button type="button" id="togglePassword" class="toggle-password-btn" aria-label="Show password">
              <span id="togglePasswordIcon" class="fa fa-eye"></span>
            </button>
          </div>
        </div>
        <button type="submit" class="login-btn" aria-label="Access application with password">üîì Access ModuMate</button>
      </form>
      <div id="loginError" class="login-error" style="display: none;" role="alert" aria-live="assertive">
        ‚ùå Incorrect password. Please try again.
      </div>
    </div>
  </div>

  <!-- Main Application (hidden until authenticated) -->
  <div id="mainApp" class="main-app" style="display: none;">
    <!-- Navbar will be loaded here -->
    <div id="navbar-container"></div>
    <main class="hero" id="mainContent">
      <h1 class="hero-title">Welcome to <span class="brand-accent">ModuMate</span></h1>
      <p class="hero-desc">Easily generate, preview, and manage aspects of your stylish module templates. Start by generating a timetable or creating a new preset for your modules.</p>
      <div class="hero-actions">
        <!-- Add main app action buttons/links here if needed -->
      </div>
    </main>
  </div>

  <!-- Config, Auth, and App Scripts (defer for performance) -->
  <script src="../scripts/config/index.js" defer></script>
  <script src="../scripts/auth/index.js" defer></script>
  <script>
    // Navbar and Footer dynamic loading for accessibility and performance
    function loadNavbar() {
      const navbarContainer = document.getElementById('navbar-container');
      if (navbarContainer) {
        fetch('../components/Navbar.html')
          .then(response => response.text())
          .then(html => {
            navbarContainer.innerHTML = html;
            // Dynamically load Navbar JS if needed
            const script = document.createElement('script');
            script.src = '../scripts/components/Navbar.js';
            script.onload = function() {
              if (window.initNavbar) window.initNavbar();
            };
            document.body.appendChild(script);
          });
      }
    }
    function loadFooter() {
      const footerContainer = document.getElementById('footer-container');
      if (footerContainer) {
        fetch('../components/Footer.html')
          .then(response => response.text())
          .then(html => {
            footerContainer.innerHTML = html;
          });
      }
    }
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize theme for accessibility
      if (typeof window.initTheme === 'function') window.initTheme();
    });
  </script>
  <!-- Footer will be loaded here -->
  <div id="footer-container"></div>
</body>
<!-- Bootstrap 5 JS Bundle (with Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
</html>